library("devtools")
install_github("isabelweng/mlelabperform",auth_token = "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")
library(mlelabperform)
?sesp_adj_prevalence()
library("devtools")
library("roxygen2")
create_package("C:/Users/yweng/Documents/Working/COVID_CZI/Packages/mlelabperform")
setwd("C:/Users/yweng/Documents/Working/COVID_CZI/Packages/mlelabperform")
document()
library("devtools")
install_github("isabelweng/mlelabperform",auth_token = "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")
library(mlelabperform)
library(mlelabperform)
detach("package:mlelabperform", unload = TRUE)
install_github("isabelweng/mlelabperform",auth_token = "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")
library(mlelabperform)
?sesp_adj_prevalence()
?sesp_adj_prevalence
?boot_results
simulate_data<-function(
n_pat=4000,
p_shc=0.5,
pcr_obs=0.02,
ab_spike_obs_pcrpos=0.8,
ab_ncap_obs_pcrpos=0.8,
ab_spike_obs_pcrneg=0.01,
ab_ncap_obs_pcrneg=0.01,
ab_spike_obs_c=0.7,# conditional probability of having a confirmatory positive spike ab given n-cap is positive
ab_ncap_obs_c=0.5,# conditional probability of having a confirmatory positive ncap given spike is positive
ab_neu_obs_con=0.9,# conditional probability of having a confirmatory positive neutraizing ab given n-cap/spike is positive
seed=1314124){
set.seed(seed)
dat_pat<-data.frame(record_id=1:n_pat,
shc=rbinom(n_pat,1,p_shc),
pcr_pos=rbinom(n_pat,1,pcr_obs)
)
dat_pat$ab_spike<-NA
dat_pat$ab_ncap<-NA
dat_pat$ab_neu<-NA
###original ab tests
n_shc<-length(dat_pat$ab_spike[dat_pat$shc==1])
n_shc_pcrpos<-length(dat_pat$ab_spike[dat_pat$shc==1 & dat_pat$pcr_pos==1])
dat_pat$ab_spike[dat_pat$shc==1 & dat_pat$pcr_pos==1]<-rbinom(n_shc_pcrpos,1, ab_spike_obs_pcrpos)
dat_pat$ab_spike[dat_pat$shc==1 & dat_pat$pcr_pos==0]<-rbinom((n_shc-n_shc_pcrpos),1, ab_spike_obs_pcrneg)
n_ucsf<-length(dat_pat$ab_spike[dat_pat$shc==0])
n_ucsf_pcrpos<-length(dat_pat$ab_spike[dat_pat$shc==0 & dat_pat$pcr_pos==1])
dat_pat$ab_ncap[dat_pat$shc==0 &  dat_pat$pcr_pos==1]<-rbinom(n_ucsf_pcrpos,1, ab_ncap_obs_pcrpos)
dat_pat$ab_ncap[dat_pat$shc==0 &  dat_pat$pcr_pos==0]<-rbinom((n_ucsf-n_ucsf_pcrpos),1, ab_ncap_obs_pcrneg)
##confirmatory ab tests
dat_pat$ab_ncap[dat_pat$shc==1]<-rbinom(n_shc,1, ab_ncap_obs_c)
dat_pat$ab_spike[dat_pat$shc==0]<-rbinom(n_ucsf,1, ab_spike_obs_c)
##neutralizing ab tests
n_initial_pos<-length(  dat_pat$ab_neu[ (dat_pat$ab_spike==1&dat_pat$shc==1 ) | (dat_pat$ab_ncap==1 & dat_pat$shc==0)])
dat_pat$ab_neu[ (dat_pat$ab_spike==1&dat_pat$shc==1 ) | (dat_pat$ab_ncap==1 & dat_pat$shc==0)]<-rbinom(n_initial_pos,1, ab_neu_obs_con)
dat_pat$ab_ncap[dat_pat$shc==1 & dat_pat$ab_spike==0]<-NA
dat_pat$ab_spike[dat_pat$shc==0 & dat_pat$ab_ncap==0]<-NA
dat_pat$ab_pos<-apply( dat_pat[,c("ab_spike","ab_ncap","ab_neu")],1,sum,na.rm=T)
dat_pat$ab_pos<-ifelse( dat_pat$ab_pos>=2,1,0)
dat_pat$pos_status<-ifelse( dat_pat$ab_pos==1|dat_pat$pcr_pos==1,1,0)
dat_pat
}
dat_simulated<-simulate_data()
table(dat_simulated$shc)
table(dat_simulated$pos_status)
table(dat_simulated$pcr_pos, dat_simulated$ab_pos)
table(dat_simulated$pcr_pos)
table(dat_simulated$ab_pos)
head(dat_simulated)
sesp_adj_prevalence(dat=dat_simulated,ab_nen_hyp_obs=0.03,r1=0.99,s1=0.9999,r2=0.9,s2=0.999,r3=0.9,s3=0.999,r4=0.9,s4=0.999)
?boot_results
?boot_results()
dat_czi_bl<-readRDS("C:/Users/yweng/Documents/Working/COVID_CZI/Codes/mlelabperform/sesp_bl.rds")
summary(dat_czi_bl)
dat_czi_bl[is.na(dat_czi_bl$ab_spike)==F & dat_czi_bl$ab_spike==99,"ab_spike"]<-NA
dat_czi_bl[is.na(dat_czi_bl$ab_ncap)==F & dat_czi_bl$ab_ncap==99,"ab_ncap"]<-NA
dat_czi_bl[is.na(dat_czi_bl$ab_neu)==F & dat_czi_bl$ab_neu==2,"ab_ncap"]<-0
summary(dat_czi_bl)
dat_czi_bl<-readRDS("C:/Users/yweng/Documents/Working/COVID_CZI/Codes/mlelabperform/sesp_bl.rds")
dat_czi_bl[is.na(dat_czi_bl$ab_spike)==F & dat_czi_bl$ab_spike==99,"ab_spike"]<-NA
dat_czi_bl[is.na(dat_czi_bl$ab_ncap)==F & dat_czi_bl$ab_ncap==99,"ab_ncap"]<-NA
dat_czi_bl[is.na(dat_czi_bl$ab_neu)==F & dat_czi_bl$ab_neu==2,"ab_neu"]<-0
summary(dat_czi_bl)
library(mlelabperform)
sesp_adj_prevalence(dat=dat_czi_bl,ab_nen_hyp_obs=0.03,r1=0.99,s1=0.9999,r2=0.9,s2=0.999,r3=0.9,s3=0.999,r4=0.9,s4=0.999)
detach("package:mlelabperform", unload = TRUE)
###User Instruction
library("devtools")
install_github("isabelweng/mlelabperform",auth_token = "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",force=T)
library(mlelabperform)
dat_czi_bl<-readRDS("C:/Users/yweng/Documents/Working/COVID_CZI/Codes/mlelabperform/sesp_bl.rds")
dat_czi_bl[is.na(dat_czi_bl$ab_spike)==F & dat_czi_bl$ab_spike==99,"ab_spike"]<-NA
dat_czi_bl[is.na(dat_czi_bl$ab_ncap)==F & dat_czi_bl$ab_ncap==99,"ab_ncap"]<-NA
dat_czi_bl[is.na(dat_czi_bl$ab_neu)==F & dat_czi_bl$ab_neu==2,"ab_neu"]<-0
library(mlelabperform)
sesp_adj_prevalence(dat=dat_czi_bl,ab_nen_hyp_obs=0.03,r1=0.99,s1=0.9999,r2=0.9,s2=0.999,r3=0.9,s3=0.999,r4=0.9,s4=0.999)
library(mlelabperform)
sesp_adj_prevalence(dat=dat_czi_bl,ab_nen_hyp_obs=0.01,r1=0.99,s1=0.9999,r2=0.9,s2=0.999,r3=0.9,s3=0.999,r4=0.9,s4=0.999)
library(mlelabperform)
sesp_adj_prevalence(dat=dat_czi_bl,ab_nen_hyp_obs=0.005,r1=0.99,s1=0.9999,r2=0.9,s2=0.999,r3=0.9,s3=0.999,r4=0.9,s4=0.999)
dat=dat_czi_bl
ab_nen_hyp_obs=0.03
##PCR, sensitivity specificity
r1=0.99
s1=0.9999
##ab spike,
r2=0.9
s2=0.999
##ab ncap,
r3=0.9
s3=0.999
##ab neutralizing,
r4=0.9
s4=0.999
s<-nrow(dat)
tao1<-mean(dat$pcr_pos,na.rm=T)
beta<-mean(dat$shc[dat$pcr_pos==0])
tao2<-mean(dat$ab_spike[dat$shc==1 & dat$pcr_pos==0],na.rm=T)
tao3<-mean(dat$ab_ncap[dat$shc==1 &dat$pcr_pos==0& dat$ab_spike==1],na.rm=T)
tao4<-mean(dat$ab_neu[dat$shc==1 & dat$pcr_pos==0& dat$ab_spike==1 & dat$ab_ncap==0],na.rm=T)
tao5<-mean(dat$ab_ncap[dat$shc==0& dat$pcr_pos==0],na.rm=T)
tao6<-mean(dat$ab_spike[dat$shc==0& dat$pcr_pos==0 & dat$ab_ncap==1],na.rm=T)
tao7<-mean(dat$ab_neu[dat$shc==0& dat$pcr_pos==0 & dat$ab_ncap==1 & dat$ab_spike==0],na.rm=T)
q1<-tao1
q2<-tao2
q3<-tao5
q4<-ab_nen_hyp_obs
p1<-(q1+s1-1)/(r1+s1-1)
p2<-(q2+s2-1)/(r2+s2-1)
p3<-(q3+s3-1)/(r3+s3-1)
p4<-(q4+s4-1)/(r4+s4-1)
x1<-r1*p1/(r1*p1+(1-s1)*(1-p1))
x2<-r2*p2/(r2*p2+(1-s2)*(1-p2))
x3<-r3*p3/(r3*p3+(1-s3)*(1-p3))
x4<-r4*p4/(r4*p4+(1-s4)*(1-p4))
y1<-(s1*(1-p1))/((1-r1)*p1+s1*(1-p1))
y2<-(s2*(1-p2))/((1-r2)*p2+s2*(1-p2))
y3<-(s3*(1-p3))/((1-r3)*p3+s3*(1-p3))
y4<-(s4*(1-p4))/((1-r4)*p4+s4*(1-p4))
x1
x2
x3
x4
x5
y1
y2
y3
y4
p2
o1
p1
p2
p3
p4
q2
s2
r
r2
tao2
mean(dat$ab_spike[dat$shc==1 & dat$pcr_pos==0],na.rm=T)
summary(dat$ab_spike)
dat_czi_bl<-readRDS("C:/Users/yweng/Documents/Working/COVID_CZI/Codes/mlelabperform/sesp_bl.rds")
dat_czi_bl[is.na(dat_czi_bl$ab_spike)==F & dat_czi_bl$ab_spike>1,"ab_spike"]<-NA
dat_czi_bl[is.na(dat_czi_bl$ab_ncap)==F & dat_czi_bl$ab_ncap==99,"ab_ncap"]<-NA
dat_czi_bl[is.na(dat_czi_bl$ab_neu)==F & dat_czi_bl$ab_neu==2,"ab_neu"]<-0
summary(dat_czi_bl)
dat_czi_bl<-readRDS("C:/Users/yweng/Documents/Working/COVID_CZI/Codes/mlelabperform/sesp_bl.rds")
dat_czi_bl[is.na(dat_czi_bl$ab_spike)==F & dat_czi_bl$ab_spike>1,"ab_spike"]<-NA
dat_czi_bl[is.na(dat_czi_bl$ab_ncap)==F & dat_czi_bl$ab_ncap>99,"ab_ncap"]<-NA
dat_czi_bl[is.na(dat_czi_bl$ab_neu)==F & dat_czi_bl$ab_neu==2,"ab_neu"]<-0
dat_czi_bl<-readRDS("C:/Users/yweng/Documents/Working/COVID_CZI/Codes/mlelabperform/sesp_bl.rds")
dat_czi_bl[is.na(dat_czi_bl$ab_spike)==F & dat_czi_bl$ab_spike>1,"ab_spike"]<-NA
dat_czi_bl[is.na(dat_czi_bl$ab_ncap)==F & dat_czi_bl$ab_ncap>1,"ab_ncap"]<-NA
dat_czi_bl[is.na(dat_czi_bl$ab_neu)==F & dat_czi_bl$ab_neu==2,"ab_neu"]<-0
summary(dat_czi_bl)
library(mlelabperform)
sesp_adj_prevalence(dat=dat_czi_bl,ab_nen_hyp_obs=0.03,r1=0.99,s1=0.9999,r2=0.9,s2=0.999,r3=0.9,s3=0.999,r4=0.9,s4=0.999)
sesp_adj_prevalence(dat=dat_czi_bl,ab_nen_hyp_obs=0.017,r1=1,s1=1,r2=0.854,s2=0.9975,r3=0.938,s3=0.994,r4=0.935,s4=0.996)
sesp_adj_prevalence(dat=dat_czi_bl,ab_nen_hyp_obs=0.1,r1=1,s1=1,r2=0.854,s2=0.9975,r3=0.938,s3=0.994,r4=0.935,s4=0.996)
sesp_adj_prevalence(dat=dat_czi_bl,ab_nen_hyp_obs=0.03,r1=1,s1=1,r2=0.854,s2=0.9975,r3=0.938,s3=0.994,r4=0.935,s4=0.996)
colnames(dat_encounter_final)
load("~/Working/Katie_NeuroHospitalist/Outputs/v3/RImage_20210721.RData")
colnames(dat_encounter_final)
table(dat_encounter_final$Patient.Type)
work_dir<-"C:/Users/yweng/Documents/Working/Katie_NeuroHospitalist"
setwd(work_dir)
dat_encounter<-read.csv(file.path(work_dir,"Data/Neurohospitalist Outcomes Shared Data/Finance_Roslind/16May2019/Neurology IP & Obsv Encounter file 2010.8.1 to 2018.7.31.csv"),stringsAsFactors = F)
dat_encounter_add<-read.csv(file.path(work_dir,"Data/Neurohospitalist Outcomes Shared Data/Finance_Roslind/11June2019/Neurology IP & Obsv Encounter file 2010.8.1 to 2018.7.31_2 MDs.csv"),stringsAsFactors = F)
dat_encounter_final<-rbind(dat_encounter,dat_encounter_add)
colnames(dat_encounter_final)<-gsub("...",".",colnames(dat_encounter_final),fixed=T)
dat_dx_2010_15<-read.csv(file.path(work_dir,"Data/Neurohospitalist Outcomes Shared Data/Finance_Roslind/16May2019/Neurology IP & Obsv DX file 2010.8.1 to 2015.9.31.csv"),stringsAsFactors = F)
dat_dx_2016_18<-read.csv(file.path(work_dir,"Data/Neurohospitalist Outcomes Shared Data/Finance_Roslind/16May2019/Neurology IP & Obsv DX file 2015.10.1 to 2018.7.31.csv"),stringsAsFactors = F)
dat_dx_add<-read.csv(file.path(work_dir,"Data/Neurohospitalist Outcomes Shared Data/Finance_Roslind/11June2019/Neurology IP & Obsv ICD9 DX file_2 MDs.csv"),stringsAsFactors = F)
dat_dx_2010_15<-dat_dx_2010_15[,1:10]
dat_dx_2016_18<-dat_dx_2016_18[,1:10]
dat_dx_add<-dat_dx_add[,1:10]
colnames(dat_dx_2010_15)<-gsub("...",".",colnames(dat_dx_2010_15),fixed=T)
colnames(dat_dx_2016_18)<-gsub("...",".",colnames(dat_dx_2016_18),fixed=T)
colnames(dat_dx_add)<-gsub("...",".",colnames(dat_dx_add),fixed=T)
colnames(dat_dx_2010_15)<-gsub("ICD9.DX.","",colnames(dat_dx_2010_15),fixed=T)
colnames(dat_dx_add)<-gsub("ICD9.DX.","",colnames(dat_dx_add),fixed=T)
colnames(dat_dx_2016_18)<-gsub("ICD10.DX.","",colnames(dat_dx_2016_18),fixed=T)
colnames(dat_dx_2010_15)<-colnames(dat_dx_2016_18)
colnames(dat_dx_add)<-colnames(dat_dx_2016_18)
dat_dx_2010_15$DX.Type<-"ICD9"
dat_dx_add$DX.Type<-"ICD9"
dat_dx_2016_18$DX.Type<-"ICD10"
dat_dx<-rbind(dat_dx_2010_15,dat_dx_2016_18,dat_dx_add)
dat_rotation<-read.csv(file.path(work_dir,"Data/Neurohospitalist Outcomes Shared Data/Attending Schedules/Attending_Rotation_Final.csv"),stringsAsFactors = F)
###Check rotation against encounter file for attending names
dat_rotation$Attending_Name[dat_rotation$Attending_Name %in% dat_encounter_final$Attending.Physician.Desc==F]
length(dat_encounter_final$Attending.Physician.Desc[dat_encounter_final$Attending.Physician.Desc %in% dat_rotation$Attending_Name==F])
dat_rotation$Start.Date<-as.Date(dat_rotation$Start.Date,"%m/%d/%Y")
dat_rotation$End.Date<-as.Date(dat_rotation$End.Date,"%m/%d/%Y")
dat_rotation_unique<-unique(dat_rotation[,1:2])
nrow(dat_encounter_final)
dat_encounter_final$Admit.Date<-as.Date(dat_encounter_final$Admit.Date,"%m/%d/%Y")
dat_encounter_final$Discharge.Date<-as.Date(dat_encounter_final$Discharge.Date,"%m/%d/%Y")
dat_encounter_final$Period<-ifelse(dat_encounter_final$Discharge.Date<as.Date("08-01-2014","%m-%d-%Y"),0,1)
dat_encounter_final$Period<-factor(
dat_encounter_final$Period,levels=c(0,1),labels=c("Pre NH","Post NH"))
nrow(dat_encounter_final)
table(dat_encounter_final$Enc.Custom.Patient.Type.Desc)
table(dat_encounter_final$NSGCR.ICU,useNA="ifany")
dat_encounter_analy<-dat_encounter_analy[dat_encounter_analy$NSGCR.ICU==0,]
nrow(dat_encounter_analy)
dat_encounter_analy<-dat_encounter_final
table(dat_encounter_final$NSGCR.ICU,useNA="ifany")
dat_encounter_analy<-dat_encounter_analy[dat_encounter_analy$NSGCR.ICU==0,]
nrow(dat_encounter_analy)
table(dat_encounter_final$UHC.Outlier.LOS.Flag,useNA="ifany")
dat_encounter_analy<-dat_encounter_analy[dat_encounter_analy$UHC.Outlier.LOS.Flag==0,]
nrow(dat_encounter_analy)
#5691
table(dat_encounter_final$DRG_Stroke_Epilepsy,useNA="ifany")
table(dat_encounter_analy$DRG_Stroke_Epilepsy, dat_encounter_analy$Attending_Type,useNA="ifany")
drg_list_stroke<-c(22,23,25,31,32,16,24,10,15,91,104)
drg_list_epilepsy<-c(37,296,34,301,300,110,298,303,323,108)
dat_encounter_final$DRG_Stroke_Epilepsy<-ifelse(is.na(dat_encounter_final$Base.MSDRG)==F &dat_encounter_final$Base.MSDRG %in% drg_list_stroke,1,ifelse(is.na(dat_encounter_final$Base.MSDRG)==F &dat_encounter_final$Base.MSDRG %in% drg_list_epilepsy & dat_encounter_final$Admission.Type.Desc=="ELECTIVE",2,ifelse(is.na(dat_encounter_final$Base.MSDRG)==F,3,NA)))
dat_encounter_final$DRG_Stroke_Epilepsy<-factor(dat_encounter_final$DRG_Stroke_Epilepsy,levels=1:3,labels=c("Stroke","Epilepsy","Non-Stroke/Epilepsy"))
table(dat_encounter_final$DRG_Stroke_Epilepsy,
dat_encounter_final$Attending_Type,useNA="ifany")
###Final Inclusion & Exclusion for our cohort
nrow(dat_encounter_final)
dat_encounter_analy<-dat_encounter_final
##Exclude patients with ICU
table(dat_encounter_final$NSGCR.ICU,useNA="ifany")
dat_encounter_analy<-dat_encounter_analy[dat_encounter_analy$NSGCR.ICU==0,]
nrow(dat_encounter_analy)
table(dat_encounter_final$UHC.Outlier.LOS.Flag,useNA="ifany")
dat_encounter_analy<-dat_encounter_analy[dat_encounter_analy$UHC.Outlier.LOS.Flag==0,]
nrow(dat_encounter_analy)
dat_encounter_analy<-dat_encounter_analy[(is.na(dat_encounter_analy$DRG_Stroke_Epilepsy)==F & dat_encounter_analy$DRG_Stroke_Epilepsy=="Non-Stroke/Epilepsy")|is.na( dat_encounter_analy$DRG_Stroke_Epilepsy),]
nrow(dat_encounter_analy)
dat_encounter_analy<-dat_encounter_analy[dat_encounter_analy$Attending.Physician.Desc %in% unique(dat_rotation$Attending_Name),]
nrow(dat_encounter_analy)
dat_encounter_analy_f<-dat_encounter_analy
nrow(dat_encounter_analy_f)
dat_encounter_analy_f$Period2<-ifelse(dat_encounter_analy_f$Period=="Pre NH",0,
ifelse(dat_encounter_analy_f$Discharge.Date>=as.Date("08/01/2014","%m/%d/%Y")&dat_encounter_analy_f$Discharge.Date<=as.Date("07/31/2016","%m/%d/%Y"),1,2))
dat_encounter_analy_f$Period2<-factor(dat_encounter_analy_f$Period2,levels=c(0,1,2),labels=c("Pre NH","Post NH 1","Post NH 2"))
table(dat_encounter_analy_f$Period2,dat_encounter_analy_f$Group)
dat_encounter_analy_f$Discharge.Year<-as.numeric(substring(as.character(dat_encounter_analy_f$Discharge.Date),1,4))
dat_encounter_analy_f$Discharge.Month<-as.numeric(substring(as.character(dat_encounter_analy_f$Discharge.Date),6,7))
unique(dat_encounter_analy_f$Attending.Physician.Desc)
unique(dat_encounter_analy_f$Attending.Physician.Desc)[order(unique(dat_encounter_analy_f$Attending.Physician.Desc))]
unique(dat_encounter_final$Attending.Physician.Desc)[order(unique(dat_encounter_final$Attending.Physician.Desc))]
dat_encounter_analy_f$Group<-ifelse(dat_encounter_analy_f$Attending.Physician.Desc %in% c("OLIVOT, JEAN-MARC","LANSBERG, MAARTEN G","ALBERS, GREGORY W","SINGH, INDER PAUL" ,"SCHWARTZ, NEIL EDWARD","TAI, WAIMEI AMY","GEORGE, PAUL","SPOKOYNY, ILANIT","MIJALSKI, CHRISTINA","VORA, NIRALI","LEE, SARAH"),0,ifelse(dat_encounter_analy_f$Attending.Physician.Desc %in% c("GRABER, KEVIN DUANE","PARVIZI, JOSEF" ,"LE, SCHEHERAZADE TRAGHIS", "FISHER, ROBERT SCOTT" ,"RAZAVI, BABAK" , "WALTER, JESSICA","VENKATASUBRAMANIAN, CHITRA","HIRSCH, KAREN GENEVIEVE","FINLEY CAULFIELD, ANNA KATHRYN" ,"HOBBS, KYLE STANLEY"),NA,1))
dat_encounter_analy_f$Group<-factor(dat_encounter_analy_f$Group,levels=c(0,1),labels=c("Control","Intervention"))
unique(dat_encounter_analy_f[is.na(dat_encounter_analy_f$Group)==F & dat_encounter_analy_f$Group=="Intervention","Attending.Physician.Desc"])
dat_encounter_analy_f<-dat_encounter_analy_f[is.na(dat_encounter_analy_f$Group)==F,]
nrow(dat_encounter_analy_f)
table(dat_encounter_analy_f$Period2,dat_encounter_analy_f$Group)
unique(dat_encounter_analy_f[dat_encounter_analy_f$Period2=="Pre NH" & dat_encounter_analy_f$Group=="Intervention","Attending.Physician.Desc"])
unique(dat_encounter_analy_f[dat_encounter_analy_f$Period2=="Pre NH" & dat_encounter_analy_f$Group=="Control","Attending.Physician.Desc"])
unique(dat_encounter_analy_f[dat_encounter_analy_f$Period2=="Post NH 2" & dat_encounter_analy_f$Group=="Intervention","Attending.Physician.Desc"])
dat_encounter_analy_f$Discharge.Year<-as.numeric(substring(as.character(dat_encounter_analy_f$Discharge.Date),1,4))
dat_encounter_analy_f$Discharge.Month<-as.numeric(substring(as.character(dat_encounter_analy_f$Discharge.Date),6,7))
write.csv(dat_encounter_analy_f,file.path(work_dir,"Data/Analytical/NH_Encounter_senAnaly_withStrokeControl_obv_v4.1.csv"),na="",row.names=F)
unique(dat_encounter_analy_f[dat_encounter_analy_f$Period2=="Post NH 2" & dat_encounter_analy_f$Group=="Control","Attending.Physician.Desc"])
save.image("~/Working/Katie_NeuroHospitalist/Data/Analytical/Inclusion_20210909.RData")
library(tidyverse)
work_dir<-"C:/Users/yweng/Documents/Working/Becky_Temp_WellKid/Data/20210827"
data1<-read.csv(file.path(work_dir,"Aim2_WellVisit.csv"),stringsAsFactors = F)
data1<-data1 %>%
group_by(MRN) %>%
mutate(n_visits=length(MRN))
data1_3plusvists<-data1[data1$n_visits>=3,]
data1_3plusvists<-data1_3plusvists[order(data1_3plusvists$MRN, data1_3plusvists$APPT_TIME),]
data1_3plusvists_uniquepatid<-unique(data1_3plusvists[,c("MRN","n_visits")])
colnames(data1_3plusvists)
dat_dx<-read.csv(file.path(work_dir,"Data/20191119/becky_dang_Dx_well_visit.csv"),stringsAsFactors = F)
dat_dx<-read.csv("C:/Users/yweng/Documents/Working/Becky_Temp_WellKid/Data/20191119/becky_dang_Dx_well_visit.csv",stringsAsFactors = F)
nrow(ata1_3plusvists_uniquepatid)
nrow(data1_3plusvists_uniquepatid)
nrow(data1_3plusvists)
colnames(dat_dx)
colnames()
colnames(data1_3plusvists)
dat_dx_3plus<-dat_dx[dat_dx$PAT_ENC_CSN_ID %in% data1_3plusvists$PAT_ENC_CSN_ID,]
length(unique(dat_dx_3plus$PAT_ENC_CSN_ID))
nrow(data1_3plusvists)
head(dat_dx_3plus)
dx_3plus_unique<-unique(dat_dx_3plus[,c("DX_ID","DX_NAME")])
nrow(dat_dx_3plus)
dx_3plus_unique<-unique(dat_dx_3plus[,c("DX_ID","DX_NAME")])
write.csv(dx_3plus_unique,file.path(work_dir,"Aim2_WellVisit_3plusvisits_uniqueDx.csv"),row.names=F,na="")
write.csv(dat_dx_3plus,file.path(work_dir,"Aim2_WellVisit_3plusvisits_AllDx.csv"),row.names=F,na="")
